//-- Control Locate
L.Control.Locate=L.Control.extend({options:{position:"topleft",drawCircle:true,follow:false,circleStyle:{color:"#136AEC",fillColor:"#136AEC",fillOpacity:0.15,weight:2,opacity:0.5},markerStyle:{color:"#136AEC",fillColor:"#2A93EE",fillOpacity:0.7,weight:2,opacity:0.9,radius:4},debug:false},onAdd:function(d){var j="leaflet-control-locate",a=j+" leaflet-control",e=L.DomUtil.create("div",j);var m=this;var f=d;this._layer=new L.LayerGroup();this._layer.addTo(f);this._event=undefined;this._locateOptions={setView:false,watch:true};this._locateOnNextLocationFound=true;this._atLocation=false;this._active=false;var c=L.DomUtil.create("div",j+"-wrap",e);var k=L.DomUtil.create("a",j,c);k.href="#";k.title="Show me where I am";var i=function(n){if(m.options.debug){console.log(n)}};L.DomEvent.on(k,"click",L.DomEvent.stopPropagation).on(k,"click",L.DomEvent.preventDefault).on(k,"click",function(){i("at location: "+m._atLocation);if(m._atLocation&&m._active){b()}else{m._active=true;m._locateOnNextLocationFound=true;if(!m._event){d.locate(m._locateOptions)}else{g()}}}).on(k,"dblclick",L.DomEvent.stopPropagation);var l=function(n){i("onLocationFound");if(m._event&&(m._event.latlng.lat!=n.latlng.lat||m._event.latlng.lon!=n.latlng.lon)){i("location has changed");m._atLocation=false}m._event=n;if(!m._active){return}if(m.options.follow){m._locateOnNextLocationFound=true}g()};var g=function(){i("visualizeLocation,setView:"+m._locateOnNextLocationFound);var n=m._event.accuracy/2;if(m._locateOnNextLocationFound){m._map.fitBounds(m._event.bounds);m._atLocation=true;m._locateOnNextLocationFound=false}m._layer.clearLayers();if(m.options.drawCircle){L.circle(m._event.latlng,n,m.options.circleStyle).addTo(m._layer)}L.circleMarker(m._event.latlng,m.options.markerStyle).bindPopup("You are within "+n.toFixed(0)+" meters from this point").addTo(m._layer);if(!m._container){return}m._container.className=a+" active"};var b=function(){m._container.className=a;m._active=false;m._layer.clearLayers()};var h=function(n){i("onLocationError");if(n.code==3&&this.options.locateOptions.watch){return}d.stopLocate();b();alert(n.message)};d.on("movestart",function(){m._atLocation=false});d.on("locationfound",l,m);d.on("locationerror",h,m);if(this.options.autoLocate){d.locate(m._locateOptions)}return e}});L.Map.addInitHook(function(){if(this.options.locateControl){this.locateControl=L.control.locate();this.addControl(this.locateControl)}});L.control.locate=function(a){return new L.Control.Locate(a)};
//-- Minimap
L.Control.MiniMap=L.Control.extend({options:{position:"bottomright",zoomLevelOffset:-5,zoomLevelFixed:false,zoomAnimation:false,width:150,height:150},initialize:function(b,a){L.Util.setOptions(this,a);this._layer=b},onAdd:function(a){this._mainMap=a;this._container=L.DomUtil.create("div","leaflet-control-minimap");this._container.style.width=this.options.width+"px";this._container.style.height=this.options.height+"px";L.DomEvent.disableClickPropagation(this._container);L.DomEvent.on(this._container,"mousewheel",L.DomEvent.stopPropagation);this._miniMap=new L.Map(this._container,{attributionControl:false,zoomControl:false,zoomAnimation:this.options.zoomAnimation,touchZoom:!this.options.zoomLevelFixed,scrollWheelZoom:!this.options.zoomLevelFixed,doubleClickZoom:!this.options.zoomLevelFixed,boxZoom:!this.options.zoomLevelFixed,});this._miniMap.addLayer(this._layer);setTimeout(L.Util.bind(function(){this._miniMap.setView(this._mainMap.getCenter(),this._decideZoom(true));this._aimingRect=L.rectangle(this._mainMap.getBounds(),{color:"#ff7800",weight:1,clickable:false}).addTo(this._miniMap)},this),1);this._mainMapMoving=false;this._miniMapMoving=false;this._mainMap.on("moveend",this._onMainMapMoved,this);this._mainMap.on("move",this._onMainMapMoving,this);this._miniMap.on("moveend",this._onMiniMapMoved,this);return this._container},onRemove:function(a){a.off("moveend",this._onMainMapMoved)},_onMainMapMoved:function(a){if(!this._miniMapMoving){this._mainMapMoving=true;this._miniMap.setView(this._mainMap.getCenter(),this._decideZoom(true))}else{this._miniMapMoving=false}this._aimingRect.setBounds(this._mainMap.getBounds())},_onMainMapMoving:function(a){this._aimingRect.setBounds(this._mainMap.getBounds())},_onMiniMapMoved:function(a){if(!this._mainMapMoving){this._miniMapMoving=true;this._mainMap.setView(this._miniMap.getCenter(),this._decideZoom(false))}else{this._mainMapMoving=false}},_decideZoom:function(a){if(!this.options.zoomLevelFixed){if(a){return this._mainMap.getZoom()+this.options.zoomLevelOffset}else{return this._miniMap.getZoom()-this.options.zoomLevelOffset}}else{if(a){return this.options.zoomLevelFixed}else{return this._mainMap.getZoom()}}}});L.Map.mergeOptions({miniMapControl:false});L.Map.addInitHook(function(){if(this.options.miniMapControl){this.miniMapControl=(new L.Control.MiniMap()).addTo(this)}});L.control.minimap=function(a){return new L.Control.MiniMap(a)};
